<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolitiFi Solana</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="https://solanatokens.github.io/politifisolana/Croq.ico" type="image/x-icon">
</head>
<body>
    <div class="container">
        <header>
            <div class="title">
                 <img src="https://securingdemocracy.gmfus.org/wp-content/uploads/2023/07/shutterstock_2327347089-scaled.jpg" alt="Elections Logo" class="block-icon">
                <h1>PolitiFi Solana</h1>
            </div>
            <div class="brought-to-you">
                <p>Brought to You by</p>
                <div class="profile">
                    <div class="profile-info">
                        <p><strong>Cryptoq</strong></p>
                        <div class="social-icons">
                            <a href="https://x.com/crypto__coq" target="_blank"><img src="https://solanatokens.github.io/politifisolana/x-icon.png" alt="Twitter"></a>
                            <a href="https://telegram.me/solanactoteam" target="_blank"><img src="https://solanatokens.github.io/politifisolana/tg-icon.png" alt="Telegram"></a>
                        </div>
                    </div>
                    <img src="https://pbs.twimg.com/profile_images/1781464826935451648/ASO_mzgr_400x400.jpg" alt="Cryptoq Logo" class="profile-logo">
                </div>
            </div>
        </header>
        <div class="top-section">
            <div class="top-row">
                <div class="block">
                    <h2>Total Market Cap</h2>
                    <p id="total-market-cap">Loading...</p>
                </div>
                <div class="block">
                    <div class="block-content">
                        <h2>Countdown to US Elections</h2>
                        <p id="countdown"></p>
                    </div>
                </div>
                <div class="block">
                    <h2>Total 24h Volume</h2>
                    <p id="total-24h-volume">Loading...</p>
                </div>
            </div>
            <div class="top-row">
                <div class="block">
                    <h2>Top Gainer in Market Cap</h2>
                    <p id="top-gainer-mc">Loading...</p>
                </div>
                <div class="block">
                    <h2>Top Gainer in Volume</h2>
                    <p id="top-gainer-volume">Loading...</p>
                </div>
                <div class="block">
                    <h2>Top Market Cap</h2>
                    <p id="top-market-cap">Loading...</p>
                </div>
            </div>
        </div>

        <p class="note">Note : if you didn't find your favorite coins here please <a href="https://x.com/crypto__coq" target="_blank">contact me on x</a> to add/update it</p>

        <section class="tabs">
            <button class="tab active" onclick="showTab('republican')">Republican</button>
            <button class="tab" onclick="showTab('democratic')">Democratic</button>
            <button class="tab" onclick="showTab('meme')">Meme</button>
        </section>

        <section id="republican" class="countries active">
            <table>
                <thead>
                    <tr>
                        <th>Tokens</th>
                        <th>Mcap</th>
                        <th>24h %</th>
                        <th>Liquidity</th>
                        <th>Socials</th>
                        <th>Community Note</th>
                    </tr>
                </thead>
                <tbody id="republican-table">
                    <!-- Tokens will be dynamically inserted here -->
                </tbody>
            </table>
        </section>

        <section id="democratic" class="countries">
            <table>
                <thead>
                    <tr>
                        <th>Countries</th>
                        <th>Mcap</th>
                        <th>24h %</th>
                        <th>Liquidity</th>
                        <th>Socials</th>
                        <th>Community Note</th>
                    </tr>
                </thead>
                <tbody id="democratic-table">
                    <!-- Tokens will be dynamically inserted here -->
                </tbody>
            </table>
        </section>

        <section id="meme" class="countries">
            <table>
                <thead>
                    <tr>
                        <th>Countries</th>
                        <th>Mcap</th>
                        <th>24h %</th>
                        <th>Liquidity</th>
                        <th>Socials</th>
                        <th>Community Note</th>
                    </tr>
                </thead>
                <tbody id="meme-table">
                    <!-- Tokens will be dynamically inserted here -->
                </tbody>
            </table>
        </section>
    </div>

    <script>
    function formatNumber(number) {
        if (number >= 1000000) {
            return (number / 1000000).toFixed(1) + 'M';
        } else if (number >= 1000) {
            return (number / 1000).toFixed(1) + 'K';
        } else {
            return number;
        }
    }

    function updateCountdown() {
        const electionDate = new Date('November 5, 2024 00:00:00').getTime();
        const now = new Date().getTime();
        const distance = electionDate - now;

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        document.getElementById('countdown').innerText = `${days} D, ${hours} H, ${minutes} M, ${seconds} S`;

        if (distance < 0) {
            clearInterval(countdownInterval);
            document.getElementById('countdown').innerText = 'Elections are over';
        }
    }

    const countdownInterval = setInterval(updateCountdown, 1000);

    async function fetchTokenData(contract) {
        const url = `https://api.dexscreener.com/latest/dex/tokens/${contract}`;
        try {
            const response = await fetch(url);
            const data = await response.json();
            console.log(`Fetched data for contract ${contract}:`, data);
            const tokenData = data.pairs.find(pair => pair.baseToken.address.toLowerCase() === contract.toLowerCase());
            return {
                name: tokenData ? tokenData.baseToken.name : 'N/A',
                symbol: tokenData ? tokenData.baseToken.symbol : 'N/A',
                logo: tokenData ? tokenData.info.imageUrl : '',
                marketCap: tokenData ? tokenData.fdv : 'N/A',
                volume24h: tokenData ? tokenData.volume.h24 : 'N/A',
                priceChange24h: tokenData ? tokenData.priceChange.h24 : 'N/A',
                liquidity: tokenData ? tokenData.liquidity.usd : 'N/A',
                socials: tokenData ? tokenData.info.socials : [],
                communityNote: tokenData ? 'Community note' : 'N/A',
                url: `https://dexscreener.com/solana/${contract}`
            };
        } catch (error) {
            console.error(`Error fetching data for contract ${contract}:`, error);
            return {
                name: 'N/A',
                symbol: 'N/A',
                logo: '',
                marketCap: 'N/A',
                volume24h: 'N/A',
                priceChange24h: 'N/A',
                liquidity: 'N/A',
                socials: [],
                communityNote: 'N/A',
                url: `https://dexscreener.com/solana/${contract}`
            };
        }
    }

    async function fetchAllTokenData(tokens) {
        const allTokens = [];
        for (const token of tokens) {
            const data = await fetchTokenData(token.contract);
            allTokens.push(data);
        }
        return allTokens;
    }

    function sortByMarketCap(tokens) {
        return tokens.sort((a, b) => parseFloat(b.marketCap) - parseFloat(a.marketCap));
    }

    function formatMarketCap(value) {
        if (value >= 1e6) {
            return (value / 1e6).toFixed(2) + 'M';
        } else if (value >= 1e3) {
            return (value / 1e3).toFixed(2) + 'K';
        } else {
            return value.toString();
        }
    }

    async function populateTable(table, tokens) {
        const allTokenData = await fetchAllTokenData(tokens);
        const sortedTokens = sortByMarketCap(allTokenData);
        table.innerHTML = ''; // Clear any existing content
        for (const data of sortedTokens) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <div style="display: flex; align-items: center;">
                        <img src="${data.logo}" alt="${data.name} Logo" class="token-logo">
                        <div style="margin-left: 10px;">
                            <span onclick="copyToClipboard('${data.contract}')" style="cursor:pointer;">
                                ${data.name}<br>
                                <span style="font-weight: bold;">$${data.symbol}</span>
                            </span>
                        </div>
                    </div>
                </td>
                <td>${formatMarketCap(data.marketCap)}</td>
                <td class="${data.priceChange24h >= 0 ? 'positive' : 'negative'}">${data.priceChange24h}%</td>
                <td>${formatMarketCap(data.liquidity)}</td>
                <td class="social-icons">
                    ${data.socials.map(social => {
                        if (social.type === 'twitter') {
                            return `<a href="${social.url}" target="_blank"><img src="https://solanatokens.github.io/politifisolana/x-icon.png" alt="Twitter" style="width: 25px; height: 25px;"></a>`;
                        } else if (social.type === 'telegram') {
                            return `<a href="${social.url}" target="_blank"><img src="https://solanatokens.github.io/politifisolana/tg-icon.png" alt="Telegram" style="width: 25px; height: 25px;"></a>`;
                        } else {
                            return `<a href="${social.url}" target="_blank"><img src="path/to/${social.type}-icon.png" alt="${social.type}"></a>`;
                        }
                    }).join(' ')}
                    <a href="${data.url}" target="_blank"><img src="https://solanatokens.github.io/politifisolana/dexscreener-e69e013b.png" alt="DexScreener" style="width: 25px; height: 25px;"></a>
                </td>
                <td>${data.communityNote}</td>
            `;
            table.appendChild(row);
        }
    }

    async function displayTokens() {
        const republicanTable = document.getElementById('republican-table');
        const democraticTable = document.getElementById('democratic-table');
        const memeTable = document.getElementById('meme-table');

        const tokens = {
            republican: [
                { name: 'Trump', contract: '4h8LjZWUfUQVgbEZ29UzTuGXNW6rwrJis78ZU66ekkPV' }
            ],
            democratic: [
                { name: 'Kamala', contract: '2tvQMBiB4aoxsXhgAPWSUpE1Cas5eSU3bNWa6p6Rpump' },            
                { name: 'Kamala2', contract: '3biDtnRND6bw8cLpSA6CNa8ewmsarTmuYwb1EVHmCXFC' },
                { name: 'Kamala3', contract: 'FTyr4aoR52GY5EWGuxSzEAY6szaYKzi3WAmHmeYppump' }
            ],
            meme: [
                { name: 'TrumpGogh', contract: 'DMAtaRGuQBbZ5kJH9VML4dqw2LpB7pYP89LZwndaU8jS' },
                { name: 'MAWC', contract: '4Y5VtnjBVKMsnauJf8LmwaZYUfEyVG4z9C9nsGiXij8J' },
                { name: 'JeoBoden', contract: '3psH1Mj1f7yUfaD5gh6Zj7epE8hhrMkMETgv5TshQA4o' }
            ]
        };

        await populateTable(republicanTable, tokens.republican);
        await populateTable(democraticTable, tokens.democratic);
        await populateTable(memeTable, tokens.meme);
    }

    displayTokens();

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert('Contract address copied to clipboard');
        });
    }

    function showTab(tab) {
        document.querySelectorAll('.countries').forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById(tab).classList.add('active');
        document.querySelectorAll('.tab').forEach(button => {
            button.classList.remove('active');
        });
        document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
    }
    </script>
</body>
</html>
